import{_ as z,r as c,a,i,b as s,e as $,k as v,n as B,t as u,F as M,h as D}from"./index-Chw7sbpC.js";import{F as I}from"./EmptyState-uA79S__T.js";const S={class:"modal-header"},U={class:"upload-content"},A={key:0,class:"file-list"},P={class:"file-list-header"},V={class:"files-grid"},H={class:"file-preview"},L=["src","alt"],E={key:1,class:"preview-placeholder"},N=["onClick"],O={class:"file-info"},R={class:"file-name"},j={class:"file-size"},x={class:"upload-actions"},G=["disabled"],K={__name:"PhotoUpload",props:{albumId:{type:String,default:null}},emits:["close","uploaded"],setup(h,{emit:g}){const k=h,p=g,d=c(null),r=c(!1),o=c([]),b=l=>{r.value=!1;const e=Array.from(l.dataTransfer.files).filter(t=>t.type.startsWith("image/"));f(e)},y=l=>{const e=Array.from(l.target.files);f(e)},f=l=>{l.forEach(e=>{const t={file:e,name:e.name,size:e.size,preview:null},n=new FileReader;n.onload=m=>{t.preview=m.target.result},n.readAsDataURL(e),o.value.push(t)})},C=l=>{o.value.splice(l,1)},F=()=>{o.value=[],d.value&&(d.value.value="")},w=l=>{if(l===0)return"0 B";const e=1024,t=["B","KB","MB","GB"],n=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,n)).toFixed(1))+" "+t[n]},_=async()=>{if(o.value.length!==0)try{const l=o.value.map(t=>t.file),e=await I.uploadFiles(l,k.albumId);p("uploaded",e),p("close")}catch(l){console.error("Upload failed:",l),alert("上传失败："+l.message)}};return(l,e)=>(i(),a("div",{class:"modal-overlay",onClick:e[6]||(e[6]=t=>l.$emit("close"))},[s("div",{class:"modal-content",onClick:e[5]||(e[5]=v(()=>{},["stop"]))},[s("div",S,[e[7]||(e[7]=s("h3",null,"上传照片",-1)),s("button",{onClick:e[0]||(e[0]=t=>l.$emit("close")),class:"close-btn"},"×")]),s("div",U,[s("div",{class:B(["drop-zone",{dragover:r.value}]),onDrop:b,onDragover:e[2]||(e[2]=v(t=>r.value=!0,["prevent"])),onDragleave:e[3]||(e[3]=v(t=>r.value=!1,["prevent"]))},[e[8]||(e[8]=s("div",{class:"upload-icon"},[s("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})])],-1)),e[9]||(e[9]=s("h4",null,"拖拽照片到这里",-1)),e[10]||(e[10]=s("p",null,"或者点击选择文件",-1)),s("input",{ref_key:"fileInput",ref:d,type:"file",multiple:"",accept:"image/*",onChange:y,class:"file-input"},null,544),s("button",{onClick:e[1]||(e[1]=t=>l.$refs.fileInput.click()),class:"select-btn"}," 选择照片 ")],34),o.value.length>0?(i(),a("div",A,[s("div",P,[s("h4",null,"已选择 "+u(o.value.length)+" 张照片",1),s("button",{onClick:F,class:"clear-btn"},"清空")]),s("div",V,[(i(!0),a(M,null,D(o.value,(t,n)=>(i(),a("div",{key:n,class:"file-item"},[s("div",H,[t.preview?(i(),a("img",{key:0,src:t.preview,alt:t.name,class:"preview-image"},null,8,L)):(i(),a("div",E,e[11]||(e[11]=[s("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"})],-1)]))),s("button",{onClick:m=>C(n),class:"remove-file-btn"}," × ",8,N)]),s("div",O,[s("p",R,u(t.name),1),s("p",j,u(w(t.size)),1)])]))),128))])])):$("",!0),s("div",x,[s("button",{onClick:e[4]||(e[4]=t=>l.$emit("close")),class:"btn-secondary"}," 取消 "),s("button",{onClick:_,disabled:o.value.length===0,class:"btn-primary"}," 开始上传 ",8,G)])])])]))}},q=z(K,[["__scopeId","data-v-d6187552"]]);export{q as P};
