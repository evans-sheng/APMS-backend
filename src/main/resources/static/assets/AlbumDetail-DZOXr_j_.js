import{l as Q,r as b,c as P,_ as w,a as i,i as n,b as t,e as g,n as W,k as A,t as k,F as M,h as z,d as x,f as T,m as X,o as Y,j as G,p as Z,u as _}from"./index-Chw7sbpC.js";import{F as K,u as tt,E as O,A as et,a as j}from"./EmptyState-uA79S__T.js";import{L as J}from"./Loading-BUMsnVdP.js";import{P as ot}from"./PhotoUpload-CNpHsULO.js";const st=Q("photo",()=>{const o=b([]),y=b(null),c=b([]),d=b(!1),C=b(null),v=b({tags:[],dateRange:null,search:""}),$=P(()=>o.value.length),h=P(()=>c.value.length),s=P(()=>{if(!Array.isArray(o.value))return console.warn("photos.value is not an array:",o.value),[];let l=[...o.value];if(v.value.tags.length>0&&(l=l.filter(u=>v.value.tags.some(f=>u.tags?.includes(f)))),v.value.search){const u=v.value.search.toLowerCase();l=l.filter(f=>f.originalName?.toLowerCase().includes(u)||f.name?.toLowerCase().includes(u)||f.tags?.some(L=>L.toLowerCase().includes(u)))}if(v.value.dateRange){const{start:u,end:f}=v.value.dateRange;l=l.filter(L=>{const q=new Date(L.createdAt);return(!u||q>=u)&&(!f||q<=f)})}return l.sort((u,f)=>new Date(f.createdAt)-new Date(u.createdAt))});return{photos:o,currentPhoto:y,selectedPhotos:c,loading:d,error:C,filters:v,photoCount:$,selectedCount:h,filteredPhotos:s,setPhotos:l=>{o.value=l},addPhoto:l=>{o.value.push(l)},addPhotos:l=>{o.value.push(...l)},updatePhoto:(l,u)=>{const f=o.value.findIndex(L=>L.id===l);f!==-1&&(o.value[f]={...o.value[f],...u})},removePhoto:l=>{const u=o.value.findIndex(f=>f.id===l);u!==-1&&o.value.splice(u,1)},removePhotos:l=>{o.value=o.value.filter(u=>!l.includes(u.id))},setCurrentPhoto:l=>{y.value=l},selectPhoto:l=>{c.value.includes(l)||c.value.push(l)},deselectPhoto:l=>{const u=c.value.indexOf(l);u!==-1&&c.value.splice(u,1)},selectAll:()=>{c.value=s.value.map(l=>l.id)},deselectAll:()=>{c.value=[]},setFilters:l=>{v.value={...v.value,...l}},clearFilters:()=>{v.value={tags:[],dateRange:null,search:""}},setLoading:l=>{d.value=l},setError:l=>{C.value=l},clearError:()=>{C.value=null}}}),lt={class:"photo-thumbnail"},nt=["src","alt"],at={key:0,class:"loading-placeholder"},it={key:1,class:"error-placeholder"},rt={class:"photo-actions"},ut={class:"photo-info"},dt={class:"photo-meta"},ct={class:"photo-date"},vt={class:"photo-size"},ht={key:0,class:"photo-tags"},pt={key:0,class:"tag more"},mt={__name:"PhotoCard",props:{photo:{type:Object,required:!0}},emits:["click","favorite","delete"],setup(o){const y=o,c=b(!1),d=b(!1),C=P(()=>K.getThumbnailUrl(y.photo.id)),v=h=>{const s=new Date(h),a=Math.abs(new Date-s),p=Math.ceil(a/(1e3*60*60*24));return p===1?"今天":p===2?"昨天":p<=7?`${p-1}天前`:s.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})},$=h=>{if(h===0)return"0 B";const s=1024,e=["B","KB","MB","GB"],a=Math.floor(Math.log(h)/Math.log(s));return parseFloat((h/Math.pow(s,a)).toFixed(1))+" "+e[a]};return(h,s)=>(n(),i("div",{class:"photo-card",onClick:s[4]||(s[4]=e=>h.$emit("click"))},[t("div",lt,[t("img",{src:C.value,alt:o.photo.fileName,class:"thumbnail-image",onLoad:s[0]||(s[0]=e=>c.value=!0),onError:s[1]||(s[1]=e=>d.value=!0)},null,40,nt),!c.value&&!d.value?(n(),i("div",at,s[5]||(s[5]=[t("div",{class:"loading-spinner"},null,-1)]))):g("",!0),d.value?(n(),i("div",it,s[6]||(s[6]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"})],-1)]))):g("",!0),t("div",rt,[t("button",{onClick:s[2]||(s[2]=A(e=>h.$emit("favorite"),["stop"])),class:W(["action-btn favorite-btn",{active:o.photo.isFavorite}]),title:"收藏"},s[7]||(s[7]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})],-1)]),2),t("button",{onClick:s[3]||(s[3]=A(e=>h.$emit("delete"),["stop"])),class:"action-btn delete-btn",title:"删除"},s[8]||(s[8]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1)]))])]),t("div",ut,[t("div",dt,[t("span",ct,k(v(o.photo.createdAt)),1),t("span",vt,k($(o.photo.size)),1)]),o.photo.tags&&o.photo.tags.length>0?(n(),i("div",ht,[(n(!0),i(M,null,z(o.photo.tags.slice(0,2),e=>(n(),i("span",{key:e,class:"tag"},k(e),1))),128)),o.photo.tags.length>2?(n(),i("span",pt," +"+k(o.photo.tags.length-2),1)):g("",!0)])):g("",!0)])]))}},ft=w(mt,[["__scopeId","data-v-713d13c3"]]),gt={class:"photo-grid"},bt={__name:"PhotoGrid",props:{photos:{type:Array,required:!0}},emits:["photo-click"],setup(o){return(y,c)=>(n(),i("div",gt,[(n(!0),i(M,null,z(o.photos,d=>(n(),x(ft,{key:d.id,photo:d,onClick:C=>y.$emit("photo-click",d)},null,8,["photo","onClick"]))),128))]))}},$t=w(bt,[["__scopeId","data-v-0d7cdada"]]),kt={class:"photo-display"},yt=["src","alt"],Ct={key:1,class:"loading-overlay"},Pt={key:2,class:"error-overlay"},xt={key:2,class:"photo-info"},Lt={class:"info-header"},wt={class:"photo-title"},At={key:0,class:"photo-counter"},Mt={class:"info-details"},zt={class:"detail-item"},Bt={class:"detail-item"},Ft={class:"detail-item"},Dt={key:0,class:"photo-tags"},St={__name:"PhotoLightbox",props:{photo:{type:Object,required:!0},photos:{type:Array,required:!0}},emits:["close","previous","next"],setup(o){const y=o,c=b(!1),d=b(!1),C=P(()=>K.getOriginalUrl(y.photo.id)),v=P(()=>y.photos.findIndex(s=>s.id===y.photo.id)),$=s=>new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),h=s=>{if(s===0)return"0 B";const e=1024,a=["B","KB","MB","GB"],p=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,p)).toFixed(1))+" "+a[p]};return(s,e)=>(n(),i("div",{class:"lightbox-overlay",onClick:e[6]||(e[6]=a=>s.$emit("close"))},[t("div",{class:"lightbox-content",onClick:e[5]||(e[5]=A(()=>{},["stop"]))},[t("button",{onClick:e[0]||(e[0]=a=>s.$emit("close")),class:"close-btn"},e[7]||(e[7]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])),o.photos.length>1?(n(),i("button",{key:0,onClick:e[1]||(e[1]=a=>s.$emit("previous")),class:"nav-btn prev-btn",title:"上一张"},e[8]||(e[8]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})],-1)]))):g("",!0),o.photos.length>1?(n(),i("button",{key:1,onClick:e[2]||(e[2]=a=>s.$emit("next")),class:"nav-btn next-btn",title:"下一张"},e[9]||(e[9]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})],-1)]))):g("",!0),t("div",kt,[o.photo?(n(),i("img",{key:0,src:C.value,alt:o.photo.fileName,class:"display-image",onLoad:e[3]||(e[3]=a=>c.value=!0),onError:e[4]||(e[4]=a=>d.value=!0)},null,40,yt)):g("",!0),!c.value&&!d.value?(n(),i("div",Ct,[T(J,{text:"加载中..."})])):g("",!0),d.value?(n(),i("div",Pt,e[10]||(e[10]=[t("div",{class:"error-content"},[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"})]),t("p",null,"图片加载失败")],-1)]))):g("",!0)]),o.photo?(n(),i("div",xt,[t("div",Lt,[t("h3",wt,k(o.photo.fileName),1),o.photos.length>1?(n(),i("div",At,k(v.value+1)+" / "+k(o.photos.length),1)):g("",!0)]),t("div",Mt,[t("div",zt,[e[11]||(e[11]=t("span",{class:"label"},"上传时间：",-1)),t("span",null,k($(o.photo.createdAt)),1)]),t("div",Bt,[e[12]||(e[12]=t("span",{class:"label"},"文件大小：",-1)),t("span",null,k(h(o.photo.size)),1)]),t("div",Ft,[e[13]||(e[13]=t("span",{class:"label"},"原始文件名：",-1)),t("span",null,k(o.photo.originalName||o.photo.name),1)])]),o.photo.tags&&o.photo.tags.length>0?(n(),i("div",Dt,[(n(!0),i(M,null,z(o.photo.tags,a=>(n(),i("span",{key:a,class:"tag"},k(a),1))),128))])):g("",!0)])):g("",!0)])]))}},Nt=w(St,[["__scopeId","data-v-b7aec06c"]]),Et={class:"album-detail"},It={key:1,class:"album-content"},Ut={class:"album-header"},Vt={class:"album-info"},Rt={class:"album-title"},Ht={key:0,class:"album-description"},qt={class:"album-meta"},Gt={class:"meta-item"},Ot={class:"meta-item"},jt={class:"album-actions"},Tt={key:0,class:"photos-section"},Kt={__name:"AlbumDetail",setup(o){const y=X();_();const c=tt(),d=st(),C=y.params.id,v=b(!1),$=b(null),h=b(!1),s=b(!1),e=b(!1),a=b(0),p=P(()=>d.filteredPhotos),B=P(()=>d.photoCount),F=P(()=>a.value>=0&&a.value<p.value.length?p.value[a.value]:null),D=async()=>{try{v.value=!0;const m=await j.getAlbum(C),r=m.data||m;$.value=r,c.setCurrentAlbum(r);const u=(await j.getAlbumPhotos(C)).data?.photos?.list||[];d.setPhotos(u)}catch(m){console.error("Failed to load album:",m),$.value=null}finally{v.value=!1}},S=m=>new Date(m).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),N=m=>{const r=p.value.findIndex(l=>l.id===m.id);r!==-1&&(a.value=r,h.value=!0)},E=()=>{h.value=!1},I=()=>{a.value>0?a.value--:a.value=p.value.length-1},U=()=>{a.value<p.value.length-1?a.value++:a.value=0},V=()=>{e.value=!0},R=m=>{d.addPhotos(m),s.value=!1},H=m=>{$.value=m,c.updateAlbum(m.id,m),e.value=!1};return Y(()=>{D()}),(m,r)=>(n(),i("div",Et,[v.value?(n(),x(J,{key:0,text:"加载相册中..."})):$.value?(n(),i("div",It,[t("div",Ut,[t("div",Vt,[t("h1",Rt,k($.value.name),1),$.value.description?(n(),i("p",Ht,k($.value.description),1)):g("",!0),t("div",qt,[t("span",Gt,k(B.value)+" 张照片",1),t("span",Ot,"创建于 "+k(S($.value.createdAt)),1)])]),t("div",jt,[t("button",{onClick:r[0]||(r[0]=l=>s.value=!0),class:"action-btn primary"},r[5]||(r[5]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1),G(" 上传照片 ")])),t("button",{onClick:V,class:"action-btn secondary"},r[6]||(r[6]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})],-1),G(" 编辑相册 ")]))])]),p.value.length>0?(n(),i("div",Tt,[T($t,{photos:p.value,onPhotoClick:N},null,8,["photos"])])):(n(),x(O,{key:1,title:"相册还是空的",description:"上传第一张照片，开始记录美好时光",icon:"photo",onAction:r[1]||(r[1]=l=>s.value=!0),"action-text":"上传照片"}))])):(n(),x(O,{key:2,title:"相册不存在",description:"您访问的相册可能已被删除或不存在",icon:"default",onAction:r[2]||(r[2]=l=>m.$router.push("/albums")),"action-text":"返回相册列表"})),h.value?(n(),x(Nt,{key:3,photo:F.value,photos:p.value,onClose:E,onPrevious:I,onNext:U},null,8,["photo","photos"])):g("",!0),s.value?(n(),x(ot,{key:4,"album-id":Z(C),onClose:r[3]||(r[3]=l=>s.value=!1),onUploaded:R},null,8,["album-id"])):g("",!0),e.value?(n(),x(et,{key:5,"editing-album":$.value,onClose:r[4]||(r[4]=l=>e.value=!1),onUpdated:H},null,8,["editing-album"])):g("",!0)]))}},Yt=w(Kt,[["__scopeId","data-v-74947d81"]]);export{Yt as default};
