import{_ as h,r as x,c as m,o as E,a as u,i as r,b as l,d as i,e as F,t as I,j as L,F as P,h as w,u as B,f as S}from"./index-Chw7sbpC.js";import{u as V,E as N,A as D,a as b}from"./EmptyState-uA79S__T.js";import{A as M}from"./AlbumCard-oqP_iNq8.js";import{L as R}from"./Loading-BUMsnVdP.js";const W={class:"album-list"},j={class:"album-header"},z={class:"album-title"},H={class:"album-count"},O={key:1,class:"album-grid"},T={__name:"AlbumList",setup(_){const v=B(),o=V(),n=x(!1),p=m(()=>o.sortedAlbums),A=m(()=>o.albumCount),f=m(()=>o.loading),g=async()=>{try{o.setLoading(!0),o.clearError();const t=(await b.getAlbums()).data?.list||[],s=await Promise.all(t.map(async a=>{if(!(a.coverPhoto||a.coverPhotoId||a.coverImageId)&&a.photoCount>0)try{const c=await b.getAlbumPhotos(a.id,{page:1,limit:1,sortBy:"created_at",sortOrder:"asc"}),d=c.data?.photos?.[0]||c.data?.list?.[0];if(d&&d.id)return{...a,firstPhotoId:d.id}}catch{}return a}));console.log("albumsWithFirstPhoto",s),o.setAlbums(s),console.log("albumStore.albums",o.albums)}catch(e){o.setError("加载相册失败："+e.message),console.error("Failed to load albums:",e)}finally{o.setLoading(!1)}},y=e=>{o.setCurrentAlbum(e),v.push(`/album/${e.id}`)},C=e=>{console.log("编辑相册:",e)},k=async e=>{if(confirm(`确定要删除相册"${e.name}"吗？此操作不可恢复。`))try{await b.deleteAlbum(e.id),o.removeAlbum(e.id)}catch(t){o.setError("删除相册失败："+t.message),console.error("Failed to delete album:",t)}},$=e=>{o.addAlbum(e),n.value=!1};return E(()=>{g()}),(e,t)=>(r(),u("div",W,[l("div",j,[l("div",z,[t[3]||(t[3]=l("h2",null,"我的相册",-1)),l("span",H,I(A.value)+" 个相册",1)]),l("button",{onClick:t[0]||(t[0]=s=>n.value=!0),class:"create-btn"},t[4]||(t[4]=[l("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[l("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1),L(" 创建相册 ")]))]),f.value?(r(),i(R,{key:0,text:"加载相册中..."})):p.value.length>0?(r(),u("div",O,[(r(!0),u(P,null,w(p.value,s=>(r(),i(M,{key:s.id,album:s,onClick:a=>y(s),onEdit:a=>C(s),onDelete:a=>k(s)},null,8,["album","onClick","onEdit","onDelete"]))),128))])):(r(),i(N,{key:2,title:"还没有相册",description:"创建您的第一个相册，开始记录美好时光",icon:"album",onAction:t[1]||(t[1]=s=>n.value=!0),"action-text":"创建相册"})),n.value?(r(),i(D,{key:3,onClose:t[2]||(t[2]=s=>n.value=!1),onCreated:$})):F("",!0)]))}},q=h(T,[["__scopeId","data-v-e188ef96"]]),G={class:"albums-page"},J={__name:"Albums",setup(_){return(v,o)=>(r(),u("div",G,[S(q)]))}},Z=h(J,[["__scopeId","data-v-bd55bbc5"]]);export{Z as default};
